version: v1.0
name: Semaphore example for Scala Play
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: "Scala with Play"
    task:
      env_vars:
        # Needed for use in scripts/test-sbt and scripts/test-gradle
        - name: SCALA_VERSION
          value: "2.12.6"
      jobs:
        - name: Tests
          matrix:
            - env_var: JAVA_VERSION
              values: ["8", "11"]
          commands:
            - checkout
              # sem-version expects binary version:
            - sem-version scala 2.12
            - sem-version java $JAVA_VERSION
            - ./scripts/test-sbt
            - ./scripts/test-gradle
      prologue:
        commands:
          - cd $HOME
          - ls -lah
          - cache restore sbt-$SEMAPHORE_GIT_BRANCH,sbt-master
          - cache restore ivy2-$SEMAPHORE_GIT_BRANCH,ivy2-master
          - cache restore gradle-$SEMAPHORE_GIT_BRANCH,gradle-master
      epilogue:
        commands:
        - cd $HOME
        - ls -lah
        - cache store sbt-$SEMAPHORE_GIT_BRANCH .sbt
        - cache store ivy2-$SEMAPHORE_GIT_BRANCH .ivy2/cache
        - cache store gradle-$SEMAPHORE_GIT_BRANCH .gradle/caches
